---
title: "474 Midterm Project"
author: "Chloe Florence and Tiffany Le"
date: "2025-09-26"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning=FALSE)
```

# Importing Data
```{r}
library(dplyr)
library(class)
library(leaps)
# creating binomial predictor for type of wine
red_wine <- read.csv("winequality-red.csv", header = TRUE, sep = ";")
red_wine["type"] = 1
white_wine <- read.csv("winequality-white.csv", header = TRUE, sep = ";")
white_wine["type"] = 0
# creating binomial predictor for if a wine is good or not.
wine <- bind_rows(red_wine, white_wine)
wine$good <- ifelse(wine$quality > 5, 1, 0)
```


# Data Exploration

## Plots

```{r}
plot(wine$total.sulfur.dioxide, jitter(wine$type), xlab = "Sulfur Dioxide", ylab = "Type") 
# looking at correlation of various predictors
cor(wine)
```

```{r}
boxplot(wine$total.sulfur.dioxide, wine$type, xlab = "Type of Wine", ylab = "Total Sulfur Dioxide")
```

```{r}
# looking for possible outliers
wine[wine[,"total.sulfur.dioxide"] > 400,]
```

```{r}
plot(wine$chlorides, jitter(wine$type), xlab = "Chlorides", ylab = "Type")
```

```{r}
# possible outliers
wine[wine[, "chlorides"] > 0.6,]
```

```{r}
# evaluating effect of outliers
plot(wine$alcohol, wine$density, xlab = "Alcohol", ylab = "Density")
wo_outlier <- wine[wine["density"] < 1.01,]
plot(wo_outlier$alcohol, wo_outlier$density, xlab = "Alcohol", ylab = "Density")
wine[wine["density"] > 1.01,]
```

## Summary Statistics
```{r}
summary(wine)
```


# Logistic Model

```{r}
set.seed(1)
train <- sample(6497, 5198)
# Logistic full model
log_mod <- glm(good ~ . - quality, data = wine, family = binomial, subset = train)
summary(log_mod)
```

```{r}
# best predictors for each number of predictors

regfit.fwd = regsubsets(good ~ . - quality,data = wine, subset = train)
summary(regfit.fwd)
```

```{r}
# Best model through Best Subset Selection with BIC criteria
library(bestglm)
model <- bestglm(wine[train,-12], IC="BIC")
model
```

## finding the test error for logistic regression

```{r}
test<- wine[-train,]
glm.probs <- predict(log_mod, test , type = "response")

glm.pred <- rep(0, 1299)
glm.pred[glm.probs > .5] <- 1

table(glm.pred, test$good)

mean(glm.pred != test$good)
```

The test error in this case was 25.096%

## Cross Validation with the logistic model

We will be training the data on 4/5ths of the data and then using the remaining 1/5 to test the data. The cross validation error will be the mean of the 5 different test errors we will get.

```{r}
# getting the 5 different samples
set.seed(1)
a <- sample(1:6497, 1299)
b <- sample(setdiff(1:6497, a), 1299)
c <- sample(setdiff(1:6497, c(a, b)), 1299)
d <- sample (setdiff(1:6497, c(a, b, c)), 1300)
e <- setdiff(1:6497, c(a, b, c, d))
```

```{r}
library(pROC)
par(mfrow=c(2,3))
samples <- list(a = a,b = b,c = c,d = d,e = e)
error <- c()
for (i in 1:5){
  # model for this training data set
  test <- samples[[i]]
  train <- setdiff(1:nrow(wine), test)
  log_mod <- glm(good ~ volatile.acidity + residual.sugar + free.sulfur.dioxide + total.sulfur.dioxide + sulphates + alcohol, data = wine, family = binomial, subset = train)
  glm.probs <- predict(log_mod, wine[test,], type = "response")
  
  glm.pred <- ifelse(glm.probs > 0.5, 1, 0)
  
  actual <- wine$good[test]
  new_err <- mean(glm.pred != actual)
  
  error <- c(error, new_err)
  
  roc_obj <- roc(actual, glm.pred)
  plot(roc_obj, main = "ROC Curve",xlab = "False Positive Rate (1 - Specificity)", 
         ylab = "True Positive Rate (Sensitivity)")
  print(auc(roc_obj))
}

error
mean(error)
```

accuracy = 1 - 0.26227 = 0.73773 ~ 73.77% accurate

Precision Average = 0.766588708513

This means on average 76.65% of the true positive are correct out of the total predicted positive.

Recall: 0.841987326462

This means on average 84.12% of the true positive are correct out of the total true positive. 

## Full Logistic Model

```{r}
full_mod <- log_mod <- glm(good ~ volatile.acidity + residual.sugar + free.sulfur.dioxide + total.sulfur.dioxide + sulphates + alcohol, data = wine, family = binomial)
summary(full_mod)
```

# KNN Algorithm
```{r}
# knn error with a as test set
train <- c(b, c, d, e)

knn_a <- knn(data.frame(volatile.acidity = wine$volatile.acidity[train], residual.sugar = wine$residual.sugar[train], free.sulfur.dioxide = wine$free.sulfur.dioxide[train], total.sulfure.dioxide = wine$total.sulfur.dioxide[train], sulfates = wine$sulphates[train], alcohol = wine$alcohol[train]), data.frame(volatile.acidity = wine$volatile.acidity[a], residual.sugar = wine$residual.sugar[a], free.sulfur.dioxide = wine$free.sulfur.dioxide[a], total.sulfure.dioxide = wine$total.sulfur.dioxide[a], sulfates = wine$sulphates[a], alcohol = wine$alcohol[a]), wine$good[train], k = 1)

table(knn_a, wine$good[a])

error_a <- mean(knn_a != wine$good[a]); error_a
```

```{r}
# knn error with b as test set
train <- c(a, c, d, e)

knn_b <- knn(data.frame(volatile.acidity = wine$volatile.acidity[train], residual.sugar = wine$residual.sugar[train], free.sulfur.dioxide = wine$free.sulfur.dioxide[train], total.sulfure.dioxide = wine$total.sulfur.dioxide[train], sulfates = wine$sulphates[train], alcohol = wine$alcohol[train]), data.frame(volatile.acidity = wine$volatile.acidity[b], residual.sugar = wine$residual.sugar[b], free.sulfur.dioxide = wine$free.sulfur.dioxide[b], total.sulfure.dioxide = wine$total.sulfur.dioxide[b], sulfates = wine$sulphates[b], alcohol = wine$alcohol[b]), wine$good[train], k = 1)

table(knn_b, wine$good[b])

error_b <- mean(knn_b != wine$good[b]); error_b
```

```{r}
# knn error with c as test set
train <- c(a, b, d, e)

knn_c <- knn(data.frame(volatile.acidity = wine$volatile.acidity[train], residual.sugar = wine$residual.sugar[train], free.sulfur.dioxide = wine$free.sulfur.dioxide[train], total.sulfure.dioxide = wine$total.sulfur.dioxide[train], sulfates = wine$sulphates[train], alcohol = wine$alcohol[train]), data.frame(volatile.acidity = wine$volatile.acidity[c], residual.sugar = wine$residual.sugar[c], free.sulfur.dioxide = wine$free.sulfur.dioxide[c], total.sulfure.dioxide = wine$total.sulfur.dioxide[c], sulfates = wine$sulphates[c], alcohol = wine$alcohol[c]), wine$good[train], k = 1)

table(knn_c, wine$good[c])

error_c <- mean(knn_c != wine$good[c]); error_c
```

```{r}
# knn error with d as test set
train <- c(a, b, c, e)

knn_d <- knn(data.frame(volatile.acidity = wine$volatile.acidity[train], residual.sugar = wine$residual.sugar[train], free.sulfur.dioxide = wine$free.sulfur.dioxide[train], total.sulfure.dioxide = wine$total.sulfur.dioxide[train], sulfates = wine$sulphates[train], alcohol = wine$alcohol[train]), data.frame(volatile.acidity = wine$volatile.acidity[d], residual.sugar = wine$residual.sugar[d], free.sulfur.dioxide = wine$free.sulfur.dioxide[d], total.sulfure.dioxide = wine$total.sulfur.dioxide[d], sulfates = wine$sulphates[d], alcohol = wine$alcohol[d]), wine$good[train], k = 1)

table(knn_d, wine$good[d])

error_d <- mean(knn_d != wine$good[d]); error_d
```

```{r}
# knn error with e as test set
train <- c(a, b, c, d)

knn_e <- knn(data.frame(volatile.acidity = wine$volatile.acidity[train], residual.sugar = wine$residual.sugar[train], free.sulfur.dioxide = wine$free.sulfur.dioxide[train], total.sulfure.dioxide = wine$total.sulfur.dioxide[train], sulfates = wine$sulphates[train], alcohol = wine$alcohol[train]), data.frame(volatile.acidity = wine$volatile.acidity[e], residual.sugar = wine$residual.sugar[e], free.sulfur.dioxide = wine$free.sulfur.dioxide[e], total.sulfure.dioxide = wine$total.sulfur.dioxide[e], sulfates = wine$sulphates[e], alcohol = wine$alcohol[e]), wine$good[train], k = 1)

table(knn_e, wine$good[e])

error_e <- mean(knn_e != wine$good[e]); error_e
```

```{r}
# mean of all 5 misclassification rates
mean(error_a, error_b, error_c, error_d, error_e)
```

```{r}
wine_knn_cv <- function(k) {
  train <- c(b, c, d, e)
  
  knn_a <- knn(data.frame(volatile.acidity = wine$volatile.acidity[train], residual.sugar = wine$residual.sugar[train], free.sulfur.dioxide = wine$free.sulfur.dioxide[train], total.sulfure.dioxide = wine$total.sulfur.dioxide[train], sulfates = wine$sulphates[train], alcohol = wine$alcohol[train]), data.frame(volatile.acidity = wine$volatile.acidity[a], residual.sugar = wine$residual.sugar[a], free.sulfur.dioxide = wine$free.sulfur.dioxide[a], total.sulfure.dioxide = wine$total.sulfur.dioxide[a], sulfates = wine$sulphates[a], alcohol = wine$alcohol[a]), wine$good[train], k = k)

  error_a <- mean(knn_a != wine$good[a])

  train <- c(a, c, d, e)
  
  knn_b <- knn(data.frame(volatile.acidity = wine$volatile.acidity[train], residual.sugar = wine$residual.sugar[train], free.sulfur.dioxide = wine$free.sulfur.dioxide[train], total.sulfure.dioxide = wine$total.sulfur.dioxide[train], sulfates = wine$sulphates[train], alcohol = wine$alcohol[train]), data.frame(volatile.acidity = wine$volatile.acidity[b], residual.sugar = wine$residual.sugar[b], free.sulfur.dioxide = wine$free.sulfur.dioxide[b], total.sulfure.dioxide = wine$total.sulfur.dioxide[b], sulfates = wine$sulphates[b], alcohol = wine$alcohol[b]), wine$good[train], k = k)

  error_b <- mean(knn_b != wine$good[b])

  train <- c(a, b, d, e)
  
  knn_c <- knn(data.frame(volatile.acidity = wine$volatile.acidity[train], residual.sugar = wine$residual.sugar[train], free.sulfur.dioxide = wine$free.sulfur.dioxide[train], total.sulfure.dioxide = wine$total.sulfur.dioxide[train], sulfates = wine$sulphates[train], alcohol = wine$alcohol[train]), data.frame(volatile.acidity = wine$volatile.acidity[c], residual.sugar = wine$residual.sugar[c], free.sulfur.dioxide = wine$free.sulfur.dioxide[c], total.sulfure.dioxide = wine$total.sulfur.dioxide[c], sulfates = wine$sulphates[c], alcohol = wine$alcohol[c]), wine$good[train], k = k)

  error_c <- mean(knn_c != wine$good[c])
  
  train <- c(a, b, c, e)
  
  knn_d <- knn(data.frame(volatile.acidity = wine$volatile.acidity[train], residual.sugar = wine$residual.sugar[train], free.sulfur.dioxide = wine$free.sulfur.dioxide[train], total.sulfure.dioxide = wine$total.sulfur.dioxide[train], sulfates = wine$sulphates[train], alcohol = wine$alcohol[train]), data.frame(volatile.acidity = wine$volatile.acidity[d], residual.sugar = wine$residual.sugar[d], free.sulfur.dioxide = wine$free.sulfur.dioxide[d], total.sulfure.dioxide = wine$total.sulfur.dioxide[d], sulfates = wine$sulphates[d], alcohol = wine$alcohol[d]), wine$good[train], k = k)
  
  error_d <- mean(knn_d != wine$good[d])
  
  train <- c(a, b, c, d)
  
  knn_e <- knn(data.frame(volatile.acidity = wine$volatile.acidity[train], residual.sugar = wine$residual.sugar[train], free.sulfur.dioxide = wine$free.sulfur.dioxide[train], total.sulfure.dioxide = wine$total.sulfur.dioxide[train], sulfates = wine$sulphates[train], alcohol = wine$alcohol[train]), data.frame(volatile.acidity = wine$volatile.acidity[e], residual.sugar = wine$residual.sugar[e], free.sulfur.dioxide = wine$free.sulfur.dioxide[e], total.sulfure.dioxide = wine$total.sulfur.dioxide[e], sulfates = wine$sulphates[e], alcohol = wine$alcohol[e]), wine$good[train], k = k)
  
  error_e <- mean(knn_e != wine$good[e])

  mean(error_a, error_b, error_c, error_d, error_e)
  }
```

## KNN error rate for different values of k

```{r}
# misclassification rate when k = 2
wine_knn_cv(2)
```

```{r}
wine_knn_cv(3)
```

```{r}
wine_knn_cv(4)
```

```{r}
wine_knn_cv(5)
```

```{r}
wine_knn_cv(6)
```

```{r}
wine_knn_cv(7)
```

```{r}
wine_knn_cv(8)
```

```{r}
wine_knn_cv(9)
```

```{r}
wine_knn_cv(10)
```

```{r}
cv_error <- numeric(100)
for (i in 1:100) {
  cv_error[i] <- wine_knn_cv(i)
}
min(cv_error)
```

This minimum error rate comes when k = 1

```{r, message = FALSE}
par(mfrow = c(2, 3))

plot(roc(wine$good[a], as.numeric(knn_a)), main = "ROC Curve", xlab = "False Positive Rate", ylab =  "True Positive Rate")

plot(roc(wine$good[b], as.numeric(knn_b)), main = "ROC Curve", xlab = "False Positive Rate", ylab =  "True Positive Rate")

plot(roc(wine$good[c], as.numeric(knn_c)), main = "ROC Curve", xlab = "False Positive Rate", ylab =  "True Positive Rate")

plot(roc(wine$good[d], as.numeric(knn_d)), main = "ROC Curve", xlab = "False Positive Rate", ylab =  "True Positive Rate")

plot(roc(wine$good[e], as.numeric(knn_e)), main = "ROC Curve", xlab = "False Positive Rate", ylab =  "True Positive Rate")

#Finding the area under the curve for the ROC curve.
auc(roc(wine$good[a], as.numeric(knn_a)))
auc(roc(wine$good[b], as.numeric(knn_b)))
auc(roc(wine$good[c], as.numeric(knn_c)))
auc(roc(wine$good[d], as.numeric(knn_d)))
auc(roc(wine$good[e], as.numeric(knn_e)))
```

```{r}
par(mfrow = c(2, 3))

boxplot(wine$volatile.acidity, wine$good, ylab = "Volatile Acidity", xlab = "Wine Quality")

boxplot(wine$residual.sugar, wine$good, ylab = "Residual Sugar", xlab = "Wine Quality")

boxplot(wine$total.sulfur.dioxide, wine$good, ylab = "Total Sulfur Dioxide", xlab = "Wine Quality")

boxplot(wine$free.sulfur.dioxide, wine$good, ylab = "Free Sulfur Dioxide", xlab = "Wine Quality")

boxplot(wine$sulphates, wine$good, ylab = "Sulphates", xlab = "Wine Quality")

boxplot(wine$alcohol, wine$good, ylab = "Alcohol", xlab = "Wine Quality")

```
